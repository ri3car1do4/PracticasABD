CREATE TABLE IF NOT EXISTS Jugador (
  id_jugador INTEGER,
  nombre VARCHAR NOT NULL,
  nombre_equipo VARCHAR,
  posicion VARCHAR(20) NOT NULL,
  altura NUMERIC(4,1) NOT NULL,
  peso NUMERIC(4,1),
  fecha_nacimiento DATE NOT NULL,
  pais VARCHAR(30) NOT NULL,
  url_imagen VARCHAR NOT NULL,
  PRIMARY KEY (id_jugador)
);

CREATE TABLE IF NOT EXISTS Partido (
  id_partido INTEGER,
  fecha DATE NOT NULL,
  equipo_local VARCHAR(30) NOT NULL,
  equipo_visitante VARCHAR(30) NOT NULL,
  gana_local BOOLEAN NOT NULL,
  url VARCHAR NOT NULL,
  PRIMARY KEY (id_partido)

);

CREATE TABLE IF NOT EXISTS Historico (
  id_jugador INTEGER,
  id_partido INTEGER,
  tiempo_jugado INTEGER NOT NULL,
  puntos_marcados INTEGER,
  puntuacion NUMERIC(4,2) NOT NULL,
  PRIMARY KEY(id_jugador, id_partido),
  FOREIGN KEY (id_jugador) REFERENCES Jugador(id_jugador),
  FOREIGN KEY (id_partido) REFERENCES Partido(id_partido)
);

CREATE TABLE IF NOT EXISTS Usuario (
  id SERIAL,
  email VARCHAR(30) UNIQUE NOT NULL,
  cumple DATE NOT NULL,
  password_hash VARCHAR NOT NULL,
  ultima_tirada DATE,
  PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS Liga (
  id SERIAL,
  nombre VARCHAR(30) NOT NULL,
  numero_participantes_maximo INTEGER NOT NULL,
  password_hash VARCHAR,
  PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS Participa_liga (
  id_liga INTEGER,
  id_usuario INTEGER,
  puntuacion_acumulada NUMERIC NOT NULL DEFAULT 0,
  PRIMARY KEY(id_liga, id_usuario),
  FOREIGN KEY (id_liga) REFERENCES Liga(id),
  FOREIGN KEY (id_usuario) REFERENCES Usuario(id)
);

CREATE TABLE IF NOT EXISTS Carta (
  id_jugador INTEGER,
  puntuacion NUMERIC(4,1) NOT NULL DEFAULT 0,
  rareza VARCHAR(15) NOT NULL,
  PRIMARY KEY (id_jugador),
  FOREIGN KEY (id_jugador) REFERENCES Jugador(id_jugador)
);

CREATE TABLE IF NOT EXISTS Carta_liga (
  id_liga INTEGER,
  id_usuario INTEGER,
  id_jugador INTEGER,
  numero_copias INTEGER NOT NULL DEFAULT 0,
  PRIMARY KEY(id_liga, id_usuario, id_jugador),
  FOREIGN KEY (id_liga, id_usuario) REFERENCES Participa_liga(id_liga, id_usuario),
  FOREIGN KEY (id_jugador) REFERENCES Carta(id_jugador)
);

\copy Jugador(id_jugador,nombre,nombre_equipo, posicion, altura, peso, fecha_nacimiento, pais, url_imagen) FROM '/Users/Ricardo/Documents/GitHub/PracticasABD/Practica2/jugador.csv' WITH CSV HEADER;